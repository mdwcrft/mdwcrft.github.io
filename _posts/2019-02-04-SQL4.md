---
title: "SQL #4: Sorting"
date: 2019-02-01
tags: []
excerpt: ":four:"
mathjax: true
---

This is the fourth in a series of SQL notes I made during the [Kubrick](https://kubrickgroup.com/) Data Engineering training course. The others are:  
[#1: Database Theory]({{ site.url }}{{ site.baseurl }}/SQL1)  
[#2: Basic SQL]({{ site.url }}{{ site.baseurl }}/SQL2)  
[#3: SELECT]({{ site.url }}{{ site.baseurl }}/SQL3)   
[#5: CTE's, Views & JOIN]({{ site.url }}{{ site.baseurl }}/SQL5)  [#6: INDEX]({{ site.url }}{{ site.baseurl }}/SQL6)  
[#7: Transactions]({{ site.url }}{{ site.baseurl }}/SQL7)  
[#8: Other Functions]({{ site.url }}{{ site.baseurl }}/SQL8)  
All the posts in this series are my personal note taking and may be updated as the course progresses.  

# Aggregation
### Mathematical
Most of the mathematical aggregation functions are self-explanatory. They are `MAX()`, `MIN()`, `COUNT()`, `SUM()`, `AVG()`, `STDEV()`, and `VAR()`. These functions are often combined with other aggregation methods to draw insight. 

### GROUP BY
`GROUP BY` is used to aggregate values by some grouping. It is an example of a *window function*, `GROUP BY` defines a *new level of detail* for the query. For example:

```sql
    SELECT 
         color
        ,sum(standardcost) AS sumcost
        ,count(*) AS cnt
    FROM Production.Product
    GROUP BY color
```
This query displays the total standard costs of the products in `Production.Product` by colour. 

### OVER
`OVER` determines the partitioning and ordering of a set of rows before a window function is applied. It keeps the same level of detail as the original table.  

The various options for `OVER` are listed below. 
```sql
OVER (    
    PARTITION BY <clause> 
    ORDER BY <clause>   
    ROW or RANGE <clause>   
      )
```  
Examples of window functions applied to `OVER` statements:  
`ROW_NUMER(<col1>) OVER (ORDER BY <col2>)` - Gives a row number if ordered by a condition
`RANK(<col1>) OVER (ORDER BY <col2>)` - Like `ROW_NUMBER` but 'tied' values are given tied position in rank
`DENSE_RANK(<col1>) OVER (ORDER BY <col2>)` - Like `RANK` but tied values only occupy one rank value


### CASE
`CASE` acts as an `IF` function in SQL, and can include an `ELSE`, for example:

```sql
SELECT ListPrice
	,CASE
		WHEN ListPrice >= 2000 THEN 'Expensive'
		WHEN ListPrice >= 500 THEN 'Moderate'
		WHEN ListPrice > 0 THEN 'Cheap'
		WHEN ListPrice <= 0 THEN 'Free'
		ELSE 'Unknown'
	END price_bin
FROM Production.Product
```
This query would bin products by price and create a new column `price_bin` to store the definitions.  

### LIKE



# Ordinal & Positional Sorting
### Ordinal
`ORDER BY` Specifies a sort depending on some column or condition. `DESC` or `ASC` can be added, the default is `ASC`


### Positional
`FIRST_VALUE()` Gives first value of a sorted set

---
# Functions

### CAST
`CAST(<val> AS DATE)` - Treats the supplied value as some other format
`TRY_CAST(<val> AS DATE)` - Same as `CAST` but enters NULL if there's an error

### Missing Data
`ISNULL(<col>, <'N/A'>)` - Replaces `NULL` with value 'NA'.
`NULLIF(<col>)` - Replaces a value with `NULL`
`COALESCE()` - Gives first value from list that is `NOT NULL`

### Maths
`CEILING()` - Round up
`FLOOR()` - Round down
`ROUND(,D)` - Round to D decimal places
`DECIMAL(,P,S)` - Round to P total digits and S significant figures
`CHECKSUM()` - Computes a hash as a number
`NEWID()` - Computes a random ID string
`RAND()` - Random number betweeen 0-1