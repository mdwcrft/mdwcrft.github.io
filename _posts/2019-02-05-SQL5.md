---
title: "SQL #5: CTE's, Views & JOIN"
date: 2019-02-01
tags: []
excerpt: ":five:"
mathjax: true
---

This is the fifth in a series of SQL notes I made during the [Kubrick](https://kubrickgroup.com/) Data Engineering training course. The others are:  
[#1: Database Theory]({{ site.url }}{{ site.baseurl }}/SQL1)  
[#2: Basic SQL]({{ site.url }}{{ site.baseurl }}/SQL2)  
[#3: SELECT]({{ site.url }}{{ site.baseurl }}/SQL3)  
[#4: Sorting]({{ site.url }}{{ site.baseurl }}/SQL4)  
[#6: INDEX]({{ site.url }}{{ site.baseurl }}/SQL6)  
[#7: Transactions]({{ site.url }}{{ site.baseurl }}/SQL7)  
[#8: Other Functions]({{ site.url }}{{ site.baseurl }}/SQL8)  

All the posts in this series are my personal note taking and may be updated as the course progresses.  

---
# Common Table Expressions
A CTE is a type of temporary table that can be used to help with complex multi-select queries. The syntax is:

```sql
;WITH cte 
AS
(
    SELECT ListPrice 
    FROM Production.Product
)
```  

---
# Views
Views are like a CTE but without containing anything other than the query. Accessing a view will just run the query that is stored in that view making them very lightweight to store but not to run.  

---
# JOIN
When using 3NF databases we have many seperated tables, a `JOIN` combines two or more of these tables into one horizontally (add columns).  

The only conditions for a join is that there is some common key, which is given after the `ON` keyword.  

### INNER JOIN
`INNER JOIN` only joins where values exist in both columns. The syntax involves a normal `FROM` detailing the first table with a surrogate, followed by the `JOIN` of the second table and the `ON` selecting the common column. The following query will output a table containing product names and colours from `Production.Product` along with an orderID and corresponding order quantity from `SalesOrderDetail` where the product ID is matched in both tables.   

```sql
SELECT
	 d.salesorderID
	,p.name
	,p.color
	,d.OrderQty
FROM sales.SalesOrderDetail d
INNER JOIN production.product p
	ON d.ProductID = p.ProductID
```
### OUTER JOIN
`OUTER JOIN` will include all distict values in the `LEFT` table listed as well as the common values (`LEFT` is default). 

### CROSS JOIN
`CROSS JOIN` joins every row from one table to every one of the other and should be used with **caution** as it can explode on even medium sized tables. An example would be creating a deck of cards from the suit types and numbers:  

```sql
SELECT
     s.suit
    ,v.value
FROM suit s
CROSS JOIN [value] v
```

### SELF JOIN
`SELF JOIN` is a relationship between two columns that exists within a single table. A common example of self joins might be an Employee / Manager hierarchy table. A manager is also an employee. An employee has a primary key employeeID. The managerID foreign key would reference the employeeID as a self join within the same table.  

---
# Set Operations
Set operations are similar to `JOIN` operations but they're vertical (add rows). For a set operation to be successful there must be the same number of columns in each table with matching data types. If this is true the operation can be placed between two `SELECT` statements.  
`UNION` - Combines tables by row, removing duplicates (requires sorting)  
`UNION ALL` - Combines tables by row, keeping duplicates (doesn't require sorting)  
`INTERSECT` - Returns rows that are common between tables  
`EXCEPT` - Returns rows that *do* appear in the first table and *do not* appear in the second  